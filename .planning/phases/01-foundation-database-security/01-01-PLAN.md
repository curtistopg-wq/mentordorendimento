---
phase: 01-foundation-database-security
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/supabase/client.ts
  - src/lib/supabase/server.ts
  - .env.local
autonomous: true
user_setup:
  - service: supabase
    why: "Database and authentication backend"
    env_vars:
      - name: NEXT_PUBLIC_SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: NEXT_PUBLIC_SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> anon/public key"
    account_setup:
      - task: "Create Supabase account and project"
        location: "https://supabase.com/dashboard"

must_haves:
  truths:
    - "Supabase packages are installed and available for import"
    - "Browser client can be created without errors"
    - "Server client can be created without errors"
  artifacts:
    - path: "src/lib/supabase/client.ts"
      provides: "Browser client factory for Client Components"
      exports: ["createClient"]
    - path: "src/lib/supabase/server.ts"
      provides: "Server client factory for Server Components and Actions"
      exports: ["createClient"]
  key_links:
    - from: "src/lib/supabase/client.ts"
      to: "@supabase/ssr"
      via: "import createBrowserClient"
      pattern: "createBrowserClient"
    - from: "src/lib/supabase/server.ts"
      to: "@supabase/ssr"
      via: "import createServerClient"
      pattern: "createServerClient"
    - from: "src/lib/supabase/server.ts"
      to: "next/headers"
      via: "cookies() for cookie handling"
      pattern: "await cookies\\(\\)"
---

<objective>
Install Supabase packages and create client utilities for browser and server environments.

Purpose: Establish the foundational Supabase connection layer that all subsequent features will use. This enables database queries, authentication, and storage access from both Client and Server Components.

Output:
- @supabase/supabase-js and @supabase/ssr packages installed
- Browser client utility at src/lib/supabase/client.ts
- Server client utility at src/lib/supabase/server.ts
- Environment variables template (.env.local)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-database-security/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Supabase packages</name>
  <files>package.json, .env.local</files>
  <action>
Install the required Supabase packages:
```bash
npm install @supabase/supabase-js @supabase/ssr
npm install supabase --save-dev
```

Create `.env.local` with placeholder values:
```
NEXT_PUBLIC_SUPABASE_URL=your_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
```

IMPORTANT: Do NOT use @supabase/auth-helpers-nextjs - it is DEPRECATED. Use @supabase/ssr instead.
  </action>
  <verify>
Run `npm ls @supabase/supabase-js @supabase/ssr` and confirm both packages appear in output.
Check that `.env.local` exists with the two environment variables.
  </verify>
  <done>
package.json includes @supabase/supabase-js ^2.x and @supabase/ssr ^0.x as dependencies.
supabase CLI is in devDependencies.
.env.local exists with NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY placeholders.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create browser client utility</name>
  <files>src/lib/supabase/client.ts</files>
  <action>
Create directory `src/lib/supabase/` if it doesn't exist.

Create `src/lib/supabase/client.ts` with:
```typescript
import { createBrowserClient } from '@supabase/ssr'

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}
```

This is a singleton-style client for use in Client Components ('use client').
It reads environment variables at runtime from the browser.
  </action>
  <verify>
Run `npx tsc --noEmit` - should complete without TypeScript errors.
File exists at src/lib/supabase/client.ts and exports createClient function.
  </verify>
  <done>
src/lib/supabase/client.ts exists, exports createClient function, imports from @supabase/ssr.
TypeScript compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create server client utility</name>
  <files>src/lib/supabase/server.ts</files>
  <action>
Create `src/lib/supabase/server.ts` with:
```typescript
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'

export async function createClient() {
  const cookieStore = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            )
          } catch {
            // The `setAll` method is called from a Server Component.
            // This can be ignored if you have middleware refreshing sessions.
          }
        },
      },
    }
  )
}
```

This client is for Server Components, Server Actions, and Route Handlers.
It uses the getAll/setAll cookie pattern (not individual get/set).
The try/catch handles the read-only nature of Server Components.
  </action>
  <verify>
Run `npx tsc --noEmit` - should complete without TypeScript errors.
File exists at src/lib/supabase/server.ts and exports async createClient function.
  </verify>
  <done>
src/lib/supabase/server.ts exists, exports async createClient function.
Uses cookies() from next/headers.
Uses getAll/setAll pattern for cookie handling.
TypeScript compiles without errors.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npm ls @supabase/supabase-js @supabase/ssr` shows both packages installed
2. `npx tsc --noEmit` completes without errors
3. Both client files exist in src/lib/supabase/
4. .env.local exists with placeholder environment variables
</verification>

<success_criteria>
1. Supabase packages installed (can be imported without errors)
2. Browser client utility exports createClient function
3. Server client utility exports async createClient function
4. Environment variables template exists
5. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-database-security/01-01-SUMMARY.md`
</output>
